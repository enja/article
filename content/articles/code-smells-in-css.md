---
title: Code smells in CSS
date: 2013-03-23
author: Harry Roberts
translator: Yuya Saito
site_url: http://csswizardry.com/
article_url: http://csswizardry.com/2012/11/code-smells-in-css/
---

## Code smells in CSS

Chris Coyierが[回答した](http://coding.smashingmagazine.com/2012/07/13/coding-qa-with-chris-coyier-code-smell-type-grid/)とある問いがある:

> CSSコードが「臭い」かどうかをどう知ることができるのか？コードがいまいち、あるいはデベロッパがいまいちかどうかの兆候はどんなものか？コードの中でどんな部分を見て、善し悪しを決定づけるのか？

Chrisの素晴らしい回答にいくつか追加して私なりに回答してみようと思う。

私はBSkyBでインハウスデベロッパとして働く毎日を送っている。私は最近のサイトではフロントエンドに1年以上もかけ(まだ作業中)て制作が必要なほどの大きなウェブサイトに携わっている。その私にとって、悪いCSSとはとても具体的で厄介な代物だ。1つのサイトの制作に数ヶ月にも渡ってかかるような場合、CSSであろうとそうでなかろうと、質の悪いコードの存在が許される余裕はなく、悪いコードは改善する必要性がある。

私がCSSのクオリティ、メンテナンス性、そして品位のようなものに対して注意していることを少しだけ(もちろん疑いの余地もなく言及していないこともある)共有しよう。

## スタイルの取り消し

スタイルを取り消すスタイル(リセット以外で)はすぐに注意が必要であるとわかる。CSSの本質からしてスタイルは、もちろん、カスケードするし、以前に定義したものから継承される。ルールセットは常に継承のみを行うべきで、以前のものに追加するべきであり、取り消しをするべきではない。

以下のようなCSSの宣言は:

```css
    border-bottom:none;
    padding:0;
    float:none;
    margin-left:0;
```

…は _往々にして_ 悪い知らせだ。もしボーダーを削除しなければならないとしたら、それを適用するのが少し早すぎたのだ。非常に説明するのが難しいので簡単な例を見ていこう:

```css
    h2{
        font-size:2em;
        margin-bottom:0.5em;
        padding-bottom:0.5em;
        border-bottom:1px solid #ccc;
    }
```

ここですべての`h2`にいつものように`font-size`やスペースのための`margin`、ほんの少しの`padding`、そしてページ上で次の要素と見た目上の区別を付けやすくするため、ラインを下部に追加した。しかし、場合によってはこのラインが **必要なくなる** ことも考えられるかも知れない。あるいは`h2`に`border`も`padding`を追加しない場面もあるかも知れない。そうなると以下のようなことになりがちだ:

```css
    h2{
        font-size:2em;
        margin-bottom:0.5em;
        padding-bottom:0.5em;
        border-bottom:1px solid #ccc;
    }
    .no-border{
        padding-bottom:0;
        border-bottom:none;
    }
```

10行のCSSに1つの醜いクラス名がある。より良い方法としては:

```css
    h2{
        font-size:2em;
        margin-bottom:0.5em;
    }
    .headline{
        padding-bottom:0.5em;
        border-bottom:1px solid #ccc;
    }
```

8行のCSS、取り消しはなく、すばらしく合理的なクラス名となった。

**スタイルシートを書き進めるに従って、スタイルを追加するのみにし、削除しないこと。** もしもスタイルの取り消しをしている自分に出会ってしまったら、多くの場合、多くのスタイルをすこし早めに追加しすぎているということになる。

この例は非常に遠慮がちな例ではあるが、私が伝えたいことを完璧に表現したよい例だ。こんなCSSが数万行に及ぶことを想像してみて欲しい。とてつもない無駄だし、とてつもなく必要のない取り消しだ。スタイルするものの前にあるシンプルなものを見破ること。複雑すぎる部分から初めて、あとで取り消し作業をするリスクを冒すべきではない。最終的に **多くのCSSを書くはめになるのに、少ないスタイルになってしまうことになる**。

以前のスタイルを取り消しをしているCSSを見ればすぐに何かしらが質の悪い設計がなされたことと、その何かは修正されるべきであることもわかる。

## マジックナンバー

これらは私にとっての特に悩みの種である。私はマジックナンバーが大嫌いだ。

マジックナンバーとは(理由もなく)「動作するから」というだけで使われている値を指す。以下の例を見てほしい:

```css
    .site-nav{
        [styles]
    }
        .site-nav > li:hover .dropdown{
            position:absolute;
            top:37px;
            left:0;
        }
```

`top:37px;` これがマジックナンバーだ。この値が正しい振る舞い(らしい)をするたった1つの理由は`li`内の`.site-nav`が _運良く_ 37pxの高さを持っているからで、`.dropdown`のフライアウトメニューはその下に出現する必要があるからだ。

ここで問題にしているのは37pxが _完璧に_ 状況に依存している点であり、だからこそ、その数字を信用することができない。もし誰かが`.site-nav`の`font-size`を変更し、29pxの高さになったとしたらどうなるか？この数字からは妥当性は失われ、他のデベロッパもこの数字をアップデートすることを知っておく必要がある。

もしChromeは _確かに_ `li`を37pxとして描画したとして、IEが36pxだったらどうなるのか？この数字はある1つの条件でしか動作しないのだ。

絶対に、 _絶対にだ_ 、なんとなく動作するからという理由で数字を使ってはいけない。このシチュエーションでは、`top:37px;`を`top:100%;`、これは基本的にはトップからすべてという意味になる、に差し替えたほうがはるかにいい。

マジックナンバーにはそれらにまつわるいくつかの問題がある。上に挙げた通り、依存できるものではないということに加えて、それらの「なんとなく動いたから」という性質から、他のデベロッパにその数字がどこからやってきたのかという情報を伝達しづらい。もしも、より複雑なマジックナンバーを使った例があったとして、そのマジックナンバーが無効になった場合、以下の1つ以上の問題に出くわすことだろう:

- 次にアサインされたデベロッパがそのマジックナンバーがどこからやってきたか分からずに削除、そして最初からやり直し。

- 次にアサインされたデベロッパは注意深い人で、マジックナンバーがどこからやってきたかわからないので、その番号に触れずに問題を修正しようとする。古くて、期限切れの、ハックっぽいマジックナンバーはコードに残ったままとなり、その次のデベロッパもその上からハックをし、あなた自身がその上からハックする羽目になる。

マジックナンバーは悪い知らせだ。すぐに期限切れになるし、他のデベロッパを混乱させる上、説明もすることもできず、信用もできない。

他人のコードで説明なしの番号に出会うことほど酷いものはない。一体その番号が何をするのか、何のために必要なのか、それに触れるべきなのか否か悩むことになる。

CSSにマジックナンバーを見かけたら私はすぐに質問をしはじめる。どうしてここにあるのか、何をするものなのか、どうやってこの番号は動作するのか、マジックナンバーを使わずに同じ結果を得ることは可能なのか？

**厄災から逃れるつもりでマジックナンバーは避けるべき。**

## 制限されたセレクタ

制限されたセレクタとは以下のようなセレクタだ:

```css
    ul.nav{}
    a.button{}
    div.header{}
```

基本は例のように不必要に要素が追加されたセレクタだ。  
これらが悪い知らせである理由は:

- 他の要素への再利用性を完璧に阻害してしまう。
- 詳細度を上げてしまう。
- ブラウザの作業負荷を上げてしまう(パフォーマンスは低下する)。

これらはすべて悪い特徴である。このセレクタは以下の様にできるし、そうするべきだ:

```css
    .nav{}
    .button{}
    .header{}
```

こうすることで、`.nav`を`ol`に適用することができるし、`.button`を`input`に適用することもできる。そしてサイトがHTML5に対応できるようになったら、ヘッダの`div`を`header`要素に変更してもスタイルが無効になる心配をしなくても済む。

パフォーマンスに関しては小さな問題にしかならないが、それでもやはり問題ではある。どうしてブラウザに対して、クラス`.button`が`a`にあるかどうかを探して貰う必要があるのか、`.button`を探して貰えば済む場合は特にだ。セレクタを制限することでブラウザの作業負荷を上げてしまうことになるわけだ。

より過剰な例としては:

```css
    ul.nav li.active a{}
    div.header a.logo img{}
    .content ul.features a.button{}
```

これらセレクタは以下のように大規模に削減するか、完全に書き直すことができる:

```css
    .nav .active a{}
    .logo > img {}
    .features-button{}
```

こうすることで:

- コードそのものの量を抑え、
- パフォーマンスを向上し、
- 可搬性を向上させ、
- 詳細度をへらすこと

ができる。

スタイルシートを見ている際、制限しすぎたセレクタを見かけ次第、どうしてそんな冗長に書く必要があったのかを知りたくなるし、どうやったら最も短くなるように削減できるかを考える。

## ハードコード/絶対値

マジックナンバーと同じように、ハードコード値も悪い知らせだ。ハードコード値とは以下の様なものを指す:

```css
    h1{
        font-size:24px;
        line-height:32px;
    }
```

`line-height:32px;` ここがよろしくない。`line-height:1.333`とするべきだろう。

行間はより寛大で、柔軟になるように常に相対値で設定するべきだ。`h1`の`font-size`を変更する際に、`line-height`にもその変更を追従させたいはずだ。相対値の`line-height`がないと、`h1`を変更する場合に以下のようになってしまう:

```css
    h1{
        font-size:24px;
        line-height:32px;
    }
    
    /**
     * Main site `h1`
     */
    .site-title{
        font-size:36px;
        line-height:48px;
    }
```

この例のように初期値が柔軟でないため、固定の`line-height`を無制限に追加しつづけることになってしまう。単位なし、そして相対の`line-height`があれば、単純に以下のようにするだけで済む:

```css
    h1{
        font-size:24px;
        line-height:1.333;
    }
    
    /**
     * Main site `h1`
     */
    .site-title{
        font-size:36px;
    }
```

大きな違いのように思えないかもしれないが、大規模プロジェクトのテキスト要素を考えてみれば非常に大きなインパクトになる。

注意: `line-height`以外にも _多くの_ 場面に当てはめられる。基本的には、_どんな_ スタイルシート内のハードコード値には注意と嫌疑が必要である。

ハードコード値には将来性がなく、柔軟でもなく、寛大でもないため避けるべきである。ハードコード値が _本当に_ 必要になる場面はスプライトくらいで、スプライトはどんな場合でも _常に_ 特定のサイズである必要がある。 

ハードコード値をスタイルシートで見かけたら、なぜそれが必要なのか、どう回避できるかを知りたいと私なら思う。

## 力ずくでやる

ハードコード値と似た流れではあるが、もう少しだけ詳細だ。CSSを力ずくで書くということはハードコードされたマジックナンバーや様々な手段を用いて、力ずくでレイアウトをすることを意味する。例を見てほしい:

```css
    .foo{
        margin-left:-3px;
        position:relative;
        z-index:99999;
        height:59px;
        float:left;
    }
```

この例は _酷い_ CSSだ。すべての宣言はハードコード値で、力ずくで、レイアウトに影響する宣言となっていて、 _明確に_ 強制的に何かを描画させたいところに描画させるためだけに利用されている。

この手のCSSが示しているのは、このような操作が必要な貧弱にコーディングがされているか、ボックスモデルへの理解が足りないか、またはその両方だ。

上手にコーディングされたレイアウトは力ずくで行う必要は一切なく、 _きちんと_ ボックスモデル、レイアウトを理解し、算出済みのスタイルをより頻繁に見るということでこのような状況になることは稀なはずだ。  

力ずくのCSSを発見しだい、どうしてそれが発生したのか、どれくらい前の段階に戻ればレイアウトをより合理的に行うことができるかを知りたくなる。

## 危険なセレクタ

「危険なセレクタ」とは影響が広範囲にわたるセレクタを意味する。非常にわかりやすく単純な危険なセレクタの例は:

```css
    div{
       background-color:#ffc;
       padding:1em;
    }
```

この例はどんなデベロッパに対してでもすぐにその叫びが聞こえるだろう。一体どうしてサイト上のすべての`div`に対して絨毯攻撃をしかけたいのか？これはいい質問だ。だとしたら、なぜ`aside{}`や`header{}`または`ul{}`というようなセレクタを使うのだろうか？このようなセレクタは、それはもう、 _とてつもなく_ 影響範囲が広く、最終的には前段で書いたようにCSSの取り消しを行うはめになる。

`header{}`の例を詳しく見ていこう…


多くの人が`header`要素を使ってサイトのメインとなるヘッダをマークアップする、それ自体はなんら問題はないが、もしサイト全体のヘッダを以下のようにスタイルしたとしたら:

```css
    header{
        padding:1em;
        background-color:#BADA55;
        color:#fff;
        margin-bottom:20px;
    }
```

…この場合は問題がないとは言えない。`header`要素は「あなたのサイトのメインヘッダ」という意味には **ならない**。仕様によれば`header`要素は複数のコンテキスト内で複数回利用することができる。この場合は`.site-header{}`のようなセレクタでターゲットするべきだ。

このように具体的なスタイルを一般的なセレクタにあてるのは危険だ。そのスタイルはその要素を再度利用する場合に、適用するべきではないエリアにスタイルが漏れてしまい、結果スタイルを取り除く作業(スタイルを取り除くのに
コードを追加する)で対抗するしかなくなってしまう。

セレクタはよい[セレクタの目的](http://csswizardry.com/2012/07/shoot-to-kill-css-selector-intent/)をもたせるようにすること。

以下を見てほしい:

```css
    ul{
        font-weight:bold;
    }
    header .media{
        float:left;
    }
```

セレクタがタイプセレクタか、上記のような非常にベーシックな抽象化をされたセレクタを見かけると、私はパニックになる。これらのセレクタは影響力が大きすぎるし、すぐに問題に直面することになるからだ。これらの要素を再利用したらすぐに必要のないスタイルを継承しているのを見ることになる。なぜなら、どこかで大きな影響力を持つセレクタがその要素にも影響を与えてしまっているからだ。

## 受動的な`!important`

`!important`には問題はない。なんの問題もないし、当然、_重要な_ ツールである。しかし、`!important`は特定の状況下で利用するべきである。

**`!important`は能動的にのみ利用するべきで、受動的に使ってはならない。**


どういう意味かというと、絶対に _常に_ スタイルを優先させたいということがあり、かつそのことが初めからわかっているというタイミングがあるということだ。

例えば、 _常に_ エラー状態は赤くなる場合に以下のように記述することにはまったく問題がない:

```css
    .error-text{
        color:#c00!important;
    }
```

もしエラーが常にテキストが青くなる`div`で発生したとして、エラー時にそのルールを変更することに対して自信を持てる。エラーは _常に_ 赤で表現される、なぜならそれはエラーだからで、ユーザに対するメッセージは常に一定に表現するべきだからだ。常にエラーが赤であるべきだから、ここでは能動的に`!important`を追加している。

`!important`が悪さをし始めるのは、それらを受動的に使う場合だ。誰かを詳細度の問題から逃がしたい時に使われた場合とも言える。またはちょっとした苦境にいて、`!important`を使って強制的に動作させるような場合だ。これらのケースは`!important`を受動的に利用している場合で、これは悪い知らせとなる。

`!important`を受動的に利用するということは、よろしくないCSSにより発生した問題を回避するためだけに利用したということになる。根源的な問題は一切解決できず、症状を抑えたにすぎない。問題そのものは存在しつづける上に、強力な詳細度を携えたレイヤを追加し、また1つ余計な詳細度問題を追加したにすぎない。

私は能動的に使っている限りでは、`!important`に気がとがめることはない。受動的に`!important`が使われていれば、すぐに質の悪い構造のCSSのせいだとわかるし、問題の解決にはリファクタが必要であり、性急な詳細度の追加などではないこともわかる。

## ID

これは私の場合と、大きなチームの場合に特化している。[以前にどうしてIDが悪いアイデアであることについて](http://csswizardry.com/2011/09/when-using-ids-can-be-a-pain-in-the-class/)は書いたとおり、IDは詳細度を引き上げ、誰も利用しないし、**CSSで利用するべきではない**。IDはHTML上のフラグメント識別子とJSのフックとして利用し、CSSでは利用しない。

利用は単純だ:

- IDはページ内で1度 _しか_ 利用できない。
- クラスはページ内で1度しか使わなくても、100万回使うこともできる。
- IDは多くの場合、再利用できるクラスに抽象化できる特徴を持っている。
- [IDは クラスの **255倍** 詳細度が高い](http://codepen.io/chriscoyier/pen/lzjqh)。
- つまり、**256の連結クラスを使ってやっと1つのIDを上書きできる**。

もし最後のポイントを読んでもIDを使うことを辞めないとしたら、私にはどうしていいかもはやわからない…

IDがスタイルシートにあれば、クラスと差し替えたくなる。詳細度こそが、プロジェクトが悪循環を始めるきっかけだ。だからこそ、小さく止めることが大切だ。

楽しいエクササイズ: [この問題](http://jsfiddle.net/csswizardry/9wGac/)を _華麗に_ 解決してほしい。ヒント: [これは華麗とはいえない](http://jsfiddle.net/csswizardry/9wGac/1/)、または[こちらも](http://jsfiddle.net/csswizardry/9wGac/2/)

&#8251;訳注: IDがクラスの255倍詳細度が高い〜という記述、およびクラスを256個連結してIDを上書きできる〜という記述について、現時点では特定のブラウザ上のバグであり、仕様としてそのように定義されているわけではありません。  
それくらい詳細度が高いのがIDである、という風に思ってください。

## ルーズなクラス名

「ルーズな」クラス名とはその目的を表現するのに十分な説明ができていないクラス名のことを指す。例えば`.card`というクラスを想像してほしい。一体このクラスは何をするものだろうか？

このクラス名は非常にルーズだ、ルーズなクラス名は以下の主要な2つの理由で非常に悪いものだと言える:

- クラス名のみだけでその目的を探り出すことができない。
- あまりにも漠然としているため、他のデベロッパが過失により再定義してしまうのが簡単にできてしまう。

初めのポイントはすごく単純だ。`.card`は何を意味するのか？なにをスタイルしているのか、Trelloっぽいコンセプトでカードがコンポーネントになっているのか？ポーカーのウェブサイトでトランプに追加したクラスなのか？クレジットカードの画像を指しているのか？ルーズすぎるため、知るよしもない。クレジットカードを意味するものだとしよう、そうするとクラスは`.credit-card-image{}`であればよりわかりやすい。長くなった？ そうだ。がより良くもなった？ もちろん！

ルーズなクラス名における2つ目の問題が(過失により)簡単に再配置/再定義されてしまうことだ。ショッピングサイトで`.card`を使ったとして、ユーザアカウントに紐づくユーザのクレジットカードのことを示しているとしよう。そして、他のデベロッパがやってきて、他人にメッセージカードを贈るオプションが付いたプレゼントが買える機能を追加するのを想像してほしい。きっとどこかで`.card`を使いたくなるはずだ、(それは _間違い_ だが) そうなったらまず間違いなく(そんな状況がそもそも考えにくいが)、`.card`クラスは再定義され、上書きされてしまう。

これらすべてはより厳密なクラス名を用いることで回避できる。`.card`や`.user`などのようなクラス名はルーズすぎて、理解するのが難しく、過失による再利用/上書きが発生しやすい。

ルーズなクラスを見かけたら、私ならいったい何を意味するのかを探し出し、名前を変更できるか聞くことだろう。  
クラス名は十分に明細なものにするべきだ。

## 最後に

そういうわけで、これらが私がCSSにおけるコードが「臭い」と感じる、_多くの_ 条件のうちの少しだ。これらは私が毎日のようにどんな犠牲を払ってでもさける努力をしている事柄だ。何ヶ月におよぶ(最終的には何年も)大きなプロジェクトの場合、統制をとることは _必要不可欠_ であり、上にあげたような事柄、もちろん他の事柄も、に注意しておくことは最優先されるべきだ。(これらがどれほど小さなサブセットであるかについていくら強調しても足りない。_もっと_ もっと多くの事柄について注意している。)

もちろんどんなルールにでもかならず例外は _ある_ 。しかしそれらはケースバイケースで評価する必要がある。多くの場合、これらは私が苦労して避けている事柄であり、遠くからでもCSSに見つけることができるものばかりだ。
